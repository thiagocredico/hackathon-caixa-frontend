<mat-card class="mat-elevation-z4 max-w-full sm:max-w-5xl mx-auto mt-4 p-2 sm:p-6 bg-gradient-to-br from-blue-50 to-white shadow-lg rounded-xl">
  <mat-card-content class="w-full flex flex-col items-center">
    <ng-container *ngIf="loading">
      <div class="flex flex-col items-center justify-center my-4 sm:my-6 w-full">
        <mat-progress-spinner diameter="32" mode="indeterminate" color="primary"></mat-progress-spinner>
        <span class="mt-2 text-blue-700 font-medium text-sm sm:text-base">Carregando...</span>
      </div>
    </ng-container>

    <ng-container *ngIf="errorMsg">
      <div class="text-center mb-2 sm:mb-4 w-full text-red-600 text-sm sm:text-base font-semibold flex items-center justify-center">
        <mat-icon color="warn" class="mr-2 text-sm sm:text-base">error</mat-icon>
        <span class="text-sm sm:text-base">{{ errorMsg }}</span>
      </div>
    </ng-container>

    <ng-container *ngIf="!loading && !errorMsg && resultado">
      <div class="w-full">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">

          <!-- Summary card -->
          <mat-card class="bg-gradient-to-br from-white/95 to-blue-50 rounded-lg shadow p-4">
            <div class="flex flex-col my-4 gap-2 justify-between mb-3">
              <div class="flex gap-3 items-center">
                <div class="rounded-full bg-transparent p-3 shadow-sm">
            <mat-icon class="text-amber-500 text-2xl w-8 h-8">insights</mat-icon>
                </div>
                <div>
                  <div class="text-lg font-semibold text-blue-800">Resumo da Simulação</div>
                  <div class="text-xs text-gray-500">Visão rápida dos principais indicadores</div>
                </div>
              </div>

              <div class="p-4 text-sm text-gray-500">Produto: <span class="font-semibold text-blue-700">{{ resultado.produto.nome }}</span></div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Parcela</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.parcelaMensal | currency:'BRL' }}</div>
                <div class="text-xs text-gray-500">{{ resultado.produto.sistema === 'SAC' ? 'Primeira parcela' : 'Parcela mensal' }}</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Valor total</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.valorTotalComJuros | currency:'BRL' }}</div>
                <div class="text-xs text-gray-500">Inclui juros e encargos</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Taxa efetiva</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.taxaEfetivaMensal | number:'1.2-2' }}%</div>
                <div class="text-xs text-gray-500">Taxa mensal equivalente</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Prazo</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.memoriaCalculo.length }} meses</div>
                <div class="text-xs text-gray-500">Sistema: <span class="font-semibold text-blue-700">{{ resultado.produto.sistema }}</span></div>
              </div>
            </div>
          </mat-card>

          <!-- Parcels / accordion schedule -->
          <mat-card class="p-4 bg-white shadow-md rounded-lg">
            <div class="flex items-start justify-between gap-4 mb-4">
              <div class="flex items-center gap-3">
                <mat-icon class="text-sky-600 w-6 h-6">receipt_long</mat-icon>
                <div>
                    <div class="text-lg font-semibold text-sky-800">Detalhes das Parcelas</div>
                    <div class="text-sm text-gray-500">Clique na linha para ver detalhes</div>
                </div>
              </div>
            </div>

            <div class="mt-2">
              <ng-container *ngIf="resultado.memoriaCalculo?.length">
                <mat-accordion>
                  <mat-expansion-panel *ngFor="let m of resultado.memoriaCalculo; let i = index">
                    <mat-expansion-panel-header>
                      <div class="flex items-center justify-between w-full">
                        <div class="flex items-center gap-3">
                          <div class="w-6 h-6 bg-white border border-sky-100 rounded-full flex items-center justify-center text-sm text-sky-700">{{ m.mes }}</div>
                        </div>
                        <div class="flex items-center gap-3">
                          <div class="text-sm font-semibold text-sky-800">{{ parcelaFor(m) | currency:'BRL' }}</div>
                          <!-- Decorative chevron that rotates when panel is expanded -->
                          <mat-icon aria-hidden="true">expand_more</mat-icon>
                          <span class="sr-only">Alternar detalhes da parcela do mês {{ m.mes }}</span>
                        </div>
                      </div>
                    </mat-expansion-panel-header>

                    <div class="p-4 bg-gray-50 rounded-b-md">
                      <div class="mb-2">
                        <div class="text-xs text-gray-500">Mês</div>
                        <div class="text-sm font-medium text-gray-800">{{ monthLabel(m.mes) }}</div>
                      </div>
                      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm">
                        <div>
                          <div class="text-xs text-gray-500">Juros</div>
                          <div class="text-sm font-medium text-gray-800">{{ m.juros | currency:'BRL' }}</div>
                        </div>
                        <div>
                          <div class="text-xs text-gray-500">Amortização</div>
                          <div class="text-sm font-medium text-gray-800">{{ m.amortizacao | currency:'BRL' }}</div>
                        </div>
                        <div>
                          <div class="text-xs text-gray-500">Saldo</div>
                          <div class="text-sm font-medium text-gray-800">{{ m.saldo | currency:'BRL' }}</div>
                        </div>
                      </div>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </ng-container>

              <ng-container *ngIf="!resultado.memoriaCalculo?.length">
                <div class="py-6 text-center text-gray-500">Nenhuma parcela disponível.</div>
              </ng-container>
            </div>
          </mat-card>
        </div>
      </div>
    </ng-container>

      <div class="text-center my-4 sm:my-6 w-full flex justify-center">
      <button mat-raised-button color="primary" (click)="irParaSimulacao()" class="min-h-[40px] px-4 sm:px-8 py-2 text-sm sm:text-base font-semibold rounded-lg shadow hover:bg-blue-700 transition-all flex items-center justify-center">
        <mat-icon class="text-amber-500 mr-2 w-5 h-5" aria-hidden="true">autorenew</mat-icon>
        Nova Simulação
      </button>
    </div>
  </mat-card-content>
</mat-card>