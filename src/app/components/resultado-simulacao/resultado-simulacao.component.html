


<mat-card class="mat-elevation-z4 max-w-full sm:max-w-5xl mx-auto mt-4 p-2 sm:p-6 bg-gradient-to-br from-blue-50 to-white shadow-lg rounded-xl">
  <mat-card-content class="w-full flex flex-col items-center">
    @if (loading) {
      <div class="flex flex-col items-center justify-center my-4 sm:my-6 w-full">
        <mat-progress-spinner diameter="32" mode="indeterminate" color="primary"></mat-progress-spinner>
        <span class="mt-2 text-blue-700 font-medium text-sm sm:text-base">Carregando...</span>
      </div>
    }
    @if (errorMsg) {
      <div class="text-center mb-2 sm:mb-4 w-full text-red-600 text-sm sm:text-base font-semibold flex items-center justify-center">
        <mat-icon color="warn" class="mr-2 text-sm sm:text-base">error</mat-icon>
        <span class="text-sm sm:text-base">{{ errorMsg }}</span>
      </div>
    }
    @if (!loading && !errorMsg && resultado) {
      <div class="w-full">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-start">
          <!-- Summary card -->
          <mat-card class="result-card p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-3">
                <div class="rounded-full bg-transparent p-3 shadow-sm">
                  <mat-icon class="icon-sky text-2xl">insights</mat-icon>
                </div>
                <div>
                  <div class="text-lg font-semibold text-blue-800">Resumo da Simulação</div>
                  <div class="text-xs text-gray-500">Visão rápida dos principais indicadores</div>
                </div>
              </div>
              <div class="text-sm text-gray-500">Produto: <span class="font-semibold text-blue-700">{{ resultado.produto.nome }}</span></div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Parcela</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.parcelaMensal | currency:'BRL' }}</div>
                <div class="text-xs text-gray-500">{{ resultado.produto.sistema === 'SAC' ? 'Primeira parcela' : 'Parcela mensal' }}</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Valor total</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.valorTotalComJuros | currency:'BRL' }}</div>
                <div class="text-xs text-gray-500">Inclui juros e encargos</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Taxa efetiva</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.taxaEfetivaMensal | number:'1.2-2' }}%</div>
                <div class="text-xs text-gray-500">Taxa mensal equivalente</div>
              </div>
              <div class="p-3 bg-white/90 rounded-lg shadow-sm">
                <div class="text-xs text-gray-500">Prazo</div>
                <div class="text-lg font-bold text-blue-800">{{ resultado.memoriaCalculo.length }} meses</div>
                <div class="text-xs text-gray-500">Sistema: <span class="font-semibold text-blue-700">{{ resultado.produto.sistema }}</span></div>
              </div>
            </div>
          </mat-card>

          <!-- Parcels / schedule card -->
          <mat-card class="parcel-card p-2">
            <div class="flex items-center justify-between p-3 border-b border-gray-100">
              <div class="flex items-center gap-3">
                <mat-icon class="icon-sky">receipt_long</mat-icon>
                <div>
                  <div class="text-base font-semibold text-blue-800">Detalhes das Parcelas</div>
                  <div class="text-xs text-gray-500">Tabela de amortização</div>
                </div>
              </div>
              <div class="text-xs text-gray-500">Total de {{ resultado.memoriaCalculo.length }} meses</div>
            </div>

            @if (resultado.memoriaCalculo.length) {
              <div class="table-container mt-3 overflow-auto">
                <mat-table [dataSource]="resultado.memoriaCalculo" class="mat-elevation-z0 min-w-[320px] w-full">
                  <ng-container matColumnDef="mes">
                    <mat-header-cell *matHeaderCellDef class="text-center px-2 py-1">Mês</mat-header-cell>
                    <mat-cell *matCellDef="let m" class="text-center px-2 py-1">{{ m.mes }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="parcela">
                    <mat-header-cell *matHeaderCellDef class="text-center px-2 py-1">Parcela</mat-header-cell>
                    <mat-cell *matCellDef="let m" class="text-center px-2 py-1">{{ m.parcela !== undefined ? (m.parcela | currency:'BRL') : (resultado.parcelaMensal | currency:'BRL') }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="juros">
                    <mat-header-cell *matHeaderCellDef class="text-center px-2 py-1">Juros</mat-header-cell>
                    <mat-cell *matCellDef="let m" class="text-center px-2 py-1">{{ m.juros | currency:'BRL' }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="amortizacao">
                    <mat-header-cell *matHeaderCellDef class="text-center px-2 py-1">Amortização</mat-header-cell>
                    <mat-cell *matCellDef="let m" class="text-center px-2 py-1">{{ m.amortizacao | currency:'BRL' }}</mat-cell>
                  </ng-container>
                  <ng-container matColumnDef="saldo">
                    <mat-header-cell *matHeaderCellDef class="text-center px-2 py-1">Saldo</mat-header-cell>
                    <mat-cell *matCellDef="let m" class="text-center px-2 py-1">{{ m.saldo | currency:'BRL' }}</mat-cell>
                  </ng-container>

                  <mat-header-row *matHeaderRowDef="['mes', 'parcela', 'juros', 'amortizacao', 'saldo']" class="text-xs sm:text-sm"></mat-header-row>
                  <mat-row *matRowDef="let row; columns: ['mes', 'parcela', 'juros', 'amortizacao', 'saldo'];" class="text-xs sm:text-sm"></mat-row>
                </mat-table>
              </div>
            }
          </mat-card>
        </div>
      </div>
    }
    <div class="text-center my-4 sm:my-6 w-full flex justify-center">
  <button mat-raised-button color="primary" (click)="irParaSimulacao()" class="px-4 sm:px-8 py-2 text-sm sm:text-base font-semibold rounded shadow hover:bg-blue-700 transition-all app-btn nova-simulacao-btn">
        <mat-icon class="icon-sky mr-2">autorenew</mat-icon>
        Nova Simulação
      </button>
    </div>
  </mat-card-content>
</mat-card>